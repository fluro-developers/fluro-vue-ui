(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{469:function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("flex-column",[e.loading?[i("fluro-page-preloader",{attrs:{contain:""}})]:i("tabset",{attrs:{justified:!0,vertical:!0}},[i("tab",{attrs:{heading:"Query Details"}},[e._t("default",[i("flex-column-body",{staticStyle:{background:"#fafafa"}},[i("v-container",[i("constrain",{attrs:{sm:""}},[i("h3",{attrs:{margin:""}},[e._v("Query Details")]),e._v(" "),i("div",{staticClass:"grid-list-xl"},[i("fluro-content-form-field",{attrs:{"form-fields":e.formFields,outline:e.showOutline,options:e.options,field:e.fieldHash.title},on:{input:e.update},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}}),e._v(" "),i("fluro-content-form-field",{attrs:{"form-fields":e.formFields,outline:e.showOutline,options:e.options,field:e.fieldHash.firstLine},on:{input:e.update},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1),e._v(" "),!e.model.query||e.model.filterType?i("fluro-panel",[i("fluro-panel-title",[e.model.disableDataTypeSelect||e.model._id?[i("h4",[e._v(e._s(e._f("definitionTitle")(e.model.filterType,!0))+" ")])]:[i("fluro-content-form-field",{attrs:{"form-fields":e.formFields,outline:e.showOutline,options:e.options,field:e.fieldHash.filterType},on:{input:e.update},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})]],2),e._v(" "),i("fluro-panel-body",[i("filter-condition-group",{attrs:{rows:e.rows,useSample:!0,mini:!0,type:e.model.filterType,debounce:e.filterDebounce},model:{value:e.model.filterConfiguration,callback:function(t){e.$set(e.model,"filterConfiguration",t)},expression:"model.filterConfiguration"}})],1)],1):e._e()],1)],1),e._v(" "),i("v-container",{staticClass:"border-top"},[i("constrain",[i("h3",{attrs:{margin:""}},[e._v("Columns")]),e._v(" "),i("column-customiser",{attrs:{sampleData:e.sample,config:e.config,loadingSample:e.loadingSample},model:{value:e.model.columns,callback:function(t){e.$set(e.model,"columns",t)},expression:"model.columns"}})],1)],1)],1)])],2)],1)],2)};o._withStripped=!0;var n=i(512),l=i(27),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("list-group",e._l(e.model,(function(t,o){return i("list-group-item",[i("v-container",{attrs:{fluid:"","grid-list-xl":""}},[i("v-layout",{attrs:{"align-start":"",row:"",wrap:""}},[i("v-flex",{staticClass:"full-width",attrs:{sm10:"",xs12:"","pa-1":""}},[i("v-layout",{attrs:{"align-start":"",row:"",wrap:""}},[i("v-flex",{attrs:{sm4:"",xs12:""}},[i("fluro-content-form-field",{attrs:{"form-fields":e.formFields,outline:e.showOutline,options:e.options,field:e.fieldHash.title},model:{value:e.model[o],callback:function(t){e.$set(e.model,o,t)},expression:"model[index]"}})],1),e._v(" "),i("v-flex",{attrs:{sm8:"",xs12:""}},[i("path-selector",{attrs:{options:e.columnKeyOptions,loading:e.loadingSample},on:{pathupdated:function(t){for(var i=arguments.length,n=Array(i);i--;)n[i]=arguments[i];return e.pathUpdated.apply(void 0,[o].concat(n))}},model:{value:e.model[o].key,callback:function(t){e.$set(e.model[o],"key",t)},expression:"model[index].key"}})],1)],1)],1),e._v(" "),i("v-flex",{staticClass:"full-width",attrs:{sm2:"",xs12:"","pa-1":""}},[i("fluro-confirm-button",{attrs:{content:"Remove"},on:{click:function(t){return e.remove(o)}},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.confirming;return[i("v-btn",{staticStyle:{transition:"all 0.1s",width:"100%"},attrs:{flat:"",block:"",color:o?"red":""}},[e._v(e._s(o?"Confirm?":"Remove"))])]}}],null,!0)})],1)],1)],1)],1)})),1),e._v(" "),i("fluro-panel",[i("fluro-panel-body",[i("form",{on:{submit:function(t){return t.preventDefault(),t.stopPropagation(),e.add()}}},[i("v-container",{attrs:{fluid:"","grid-list-xl":"","pa-1":""}},[i("v-layout",{attrs:{row:"",wrap:"","grid-list-xl":""}},[i("v-flex",{attrs:{sm10:"",xs12:""}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{sm4:"",xs12:""}},[i("fluro-content-form-field",{attrs:{"form-fields":e.formFields,outline:e.showOutline,options:e.options,field:e.fieldHash.title},model:{value:e.proposed,callback:function(t){e.proposed=t},expression:"proposed"}})],1),e._v(" "),i("v-flex",{attrs:{sm8:"",xs12:""}},[i("path-selector",{attrs:{options:e.columnKeyOptions,loading:e.loadingSample},on:{pathupdated:e.proposedPathUpdated},model:{value:e.proposed.key,callback:function(t){e.$set(e.proposed,"key",t)},expression:"proposed.key"}})],1)],1)],1),e._v(" "),i("v-flex",{attrs:{sm2:"",xs12:""}},[i("v-btn",{attrs:{block:"",color:"primary",type:"submit",disabled:!e.proposed.key},on:{click:function(t){return e.add()}}},[e._v("Add")])],1)],1)],1)],1)])],1)],1)};a._withStripped=!0;var r=i(174),s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("v-layout",{attrs:{row:""}},[i("v-flex",{attrs:{"pr-0":""}},[i("v-select",{staticStyle:{overflow:"hidden","white-space":"nowrap"},attrs:{items:e.options,label:"Key Value","item-value":"key","item-text":"title",loading:!!e.loading&&"primary"},scopedSlots:e._u([{key:"selection",fn:function(t){var o=t.item;return[i("span",{staticStyle:{overflow:"hidden","white-space":"nowrap"}},[e._v(e._s(o.title))])]}}]),model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1),e._v(" "),i("v-flex",{attrs:{shrink:"","px-0":""}},[i("v-btn",{staticStyle:{height:"44px"},attrs:{flat:"",block:""},on:{click:e.toggle}},[i("fluro-icon",{attrs:{icon:e.expanded?"chevron-down":"chevron-left"}})],1)],1)],1),e._v(" "),e.expanded?i("div",{staticClass:"dropdown-box py-0"},[i("v-text-field",{attrs:{"single-line":""},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}})],1):e._e(),e._v(" "),i("div",{staticClass:"muted mb-0",style:e.expanded?"margin-top: -18px":"margin-top: -30px"},[e._v("\n    \t"+e._s(e.model)+"\n    ")])],1)};s._withStripped=!0;var d={props:{options:{type:Array,required:!0},loading:{type:Boolean,default:!1},value:{type:String,required:!0}},data(){return{model:this.value,expanded:!1}},watch:{model:function(e){return this.$emit("pathupdated",e)},value:function(e){this.model=e}},methods:{toggle(){this.expanded=!this.expanded}}},u=(i(733),i(0)),p=Object(u.a)(d,s,[],!1,null,"35e0877e",null);p.options.__file="src/components/content/edit/components/PathSelector.vue";var f=p.exports,c={mixins:[n.a],props:{value:{type:Array,default:function(){return[]}},sampleData:{type:Array,default:function(){return[]}},config:{type:Object},loadingSample:{type:Boolean,default:!1}},created(){},components:{FluroConfirmButton:r.default,PathSelector:f},data(){return{model:this.value,proposed:{title:"",key:""}}},methods:{add(){var e=JSON.parse(JSON.stringify(this.proposed));this.model.push(e),this.$set(this,"proposed",{title:"",key:""})},proposedPathUpdated(e){this.proposed.key=e},pathUpdated(e,t){this.model[e].key=t},remove(e){this.model.splice(e,1)},extract(e){var t=this,i=this.flatten(e);return _.chain(i).map((function(i,o){var n=o.split(".").length;_.times(n-1,(function(){;"      "}));var l=_.get(e,o),a=o+" - "+i;if(_.isArray(l)&&("array",a=o+" (multiple items)"),_.isString(l)){var r=t.$fluro.date.moment(l,t.$fluro.date.moment.ISO_8601,!0);r.isValid()&&(l=r.toDate())}return _.isDate(l)&&"date",{key:o,title:a}})).sortBy((function(e){return e.title})).value()},flatten(e){var t={},i=[],o=[];return function e(n,l){var a,r,s,d,u;if(null!=l)if(typeof l,"object"!=typeof l)t[n]=l;else{if((d=i.indexOf(l))>=0)return u=o[d]||"this",void(t[n]="[Circular ("+u+")]");if(i.push(l),o.push(n),Array.isArray(l)){for(r=l.length,e(n),r>10&&(r=10),a=0;a<r;a++)e(n+"["+a+"]",l[a]);return}for(n&&(n+="."),0==(r=(s=Object.keys(l)).length)&&e(n,null),a=0;a<r;a++)e(n+s[a],l[s[a]])}else{if(""===n)return;t[n]=null}}("",e),t}},computed:{fieldsOutput(){var e,t=[];return(e={title:"Column Title",minimum:0,maximum:1,type:"string"}).key="title",t.push(e),t},sampleQuery(){var e=this;return e.sampleData.length?_.chain(e.sampleData).reduce((function(t,i){var o=e.extract(i);return _.each(o,(function(e){var i=t[e.key];i||((i=t[e.key]=e).examples=[]),-1==i.examples.indexOf(e.value)&&i.examples.push(e.value)})),t}),{}).values().value():[]},columnKeyOptions(){if(!this.sampleQuery||!this.sampleQuery.length)return[];var e=JSON.parse(JSON.stringify(this.sampleQuery));return e.splice(0,0,{title:"Select a Data Source",key:""}),e}}},m=(i(735),Object(u.a)(c,a,[],!1,null,null,null));m.options.__file="src/components/content/edit/components/ColumnCustomiser.vue";var h=m.exports,v=(i(7),i(4)),y={mixins:[n.a],components:{FilterConditionGroup:l.default,ColumnCustomiser:h},methods:{modelUpdated(){this.update(this.model)},reloadSample(){var e=this;if(e.model.filterType)return e.loadingSample=!0,e.$fluro.api.post(`/content/${e.model.filterType}/filter`,{filter:e.model.filterConfiguration,startDate:e.model.filterStartDate,endDate:e.model.filterEndDate,search:e.model.filterSearch,allDefinitions:!0,sample:!0,limit:5}).then((function(t){e.sample=t.data,e.loadingSample=!1})).catch((function(t){e.sample=[],e.loadingSample=!1}));console.log("NO FILTER TYPE")}},created(){this.model.filterConfiguration||(this.model.filterConfiguration={}),this.reloadSample()},watch:{changeString(){this.reloadSample()}},asyncComputed:{typeOptions:{default:[],get(){var e=this;return e.model.query?new Promise((function(e,t){return t()})):new Promise((function(t,i){e.$fluro.types.terms().then((function(i){var o=_.chain(i).map((function(t,i){return{name:t.parentType?`${e.$fluro.types.readable(t.parentType)} - ${e.$fluro.types.readable(i)}`:""+e.$fluro.types.readable(i),value:i,parentType:t.parentType}})).orderBy("name").values().value();o.unshift({name:"Anything",key:"node",value:"node"}),t(o)})).catch((function(e){i(e)}))}))}}},computed:{rows:()=>[],showOutline:()=>!1,fieldsOutput(){var e=[];function t(t,i){i.key=t,e.push(i)}return t("title",{title:"Title",minimum:1,maximum:1,type:"string",placeholder:"Eg. My Awesome List"}),t("firstLine",{title:"Description",minimum:0,maximum:1,type:"string",placeholder:"Eg. A list of my favorite people"}),t("filterType",{title:"Type",minimum:0,maximum:1,type:"string",directive:"select",description:"The type of item you want to return from this query",options:this.typeOptions}),e},changeString(){if(!this.model.query){var e=v.FilterService.getFilterChangeString(this.model.filterConfiguration);return console.log("Filter configuration changed",e),""+e}}},data:()=>({sample:[],loadingSample:!1,filterDebounce:500})},g=(i(737),Object(u.a)(y,o,[],!1,null,"32cd5a17",null));g.options.__file="src/components/content/edit/panels/query.vue";t.default=g.exports},512:function(e,t,i){"use strict";var o=i(10);t.a={props:{config:{type:Object,required:!0},context:{type:String,default:"new"}},data:()=>({loading:!1}),mounted(){this.$set(this.model,"_type",this.config.type.definitionName)},extends:o.default,components:{FluroContentForm:o.default,FluroContentFormField:()=>Promise.resolve().then(i.bind(null,11)),FluroPrivacySelect:()=>i.e(54).then(i.bind(null,513))},computed:{type(){return this.config.type},typeName(){return this.type?this.type.definitionName:""},itemID(){return this.model._id},definition(){return this.config.definition},definedFields(){return this.definition&&this.definition.fields&&this.definition.fields.length?this.definition.fields:[]},readableContentType(){return this.$fluro.types.readable(this.config.definition?this.config.definition.definitionName:this.config.type.definitionName)},fullBody(){return this.definition&&this.definition.data&&this.definition.data.fullBody},hideBody(){return this.definition&&this.definition.data&&this.definition.data.hideBody},titleLabel:()=>"Title",bodyLabel:()=>"Body"},methods:{}}},593:function(e,t,i){var o=i(734);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,i(3).default)("c2ccab62",o,!1,{})},594:function(e,t,i){var o=i(736);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,i(3).default)("f064ffa4",o,!1,{})},595:function(e,t,i){var o=i(738);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,i(3).default)("04a8fe70",o,!1,{})},733:function(e,t,i){"use strict";var o=i(593);i.n(o).a},734:function(e,t,i){(e.exports=i(2)(!1)).push([e.i,".dropdown-box[data-v-35e0877e]{width:100%;margin-top:-44px}\n",""])},735:function(e,t,i){"use strict";var o=i(594);i.n(o).a},736:function(e,t,i){(e.exports=i(2)(!1)).push([e.i,".full-width{width:100%}\n",""])},737:function(e,t,i){"use strict";var o=i(595);i.n(o).a},738:function(e,t,i){(e.exports=i(2)(!1)).push([e.i,".hint[data-v-32cd5a17]{font-size:10px;opacity:0.5;color:inherit;display:block}\n",""])}}]);